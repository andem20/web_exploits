<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comments</title>
</head>
<body>
    <form id="form">
        <label for="username">Username</label><br />
        <input type="text" name="username" id="username"><br />
        <label for="comment">Comment</label><br />
        <textarea name="comment" id="comment" cols="30" rows="10"></textarea><br />
        <input type="submit" value="Submit">
    </form>
    <br />
    <div id="comments">
    </div>

    <script>
        const form = document.getElementById('form');
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const obj = {};
            const formData = new FormData(form);
            for (const key of formData.keys()) {
                obj[key] = formData.get(key);
            }

            const request = await fetch('/comments', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(obj)
            });
            const response = await request.text();
            fetchComments();
        });

        function fetchComments() {
            fetch('/comments').then(comments => comments.json()).then(data => {
                let comments = '';
                for(let comment of data) {
                    const commentData = `
                        <ul>
                            <li>Username: ${comment.username}</li>
                            <li>Comment: ${comment.comment}</li>
                        </ul>
                    `;
                    comments += commentData;
                }

                document.getElementById('comments').innerHTML = comments;
            });
        }

        fetchComments();
    </script>
</body>
</html>